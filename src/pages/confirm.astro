---
import BaseLayout from '@/layouts/BaseLayout.astro';

const url = new URL(Astro.request.url);
const token = url.searchParams.get('token');
---

<BaseLayout title="Confirm Subscription | Akrade" description="Confirm your newsletter subscription">
  <main class="confirm-page">
    <section class="confirm-card" aria-live="polite">
      <strong>BusyFolk Newsletter</strong>
      <h1 id="confirm-status">Processing your confirmation.</h1>
    </section>
  </main>

  <script is:inline>
    // Force light theme on confirmation page
    document.documentElement.setAttribute('data-theme', 'light');
  </script>

  <script>
    (async () => {
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token');
      const statusEl = document.getElementById('confirm-status');

      if (!token) {
        statusEl.textContent = 'Missing confirmation token.';
        return;
      }

      try {
        const res = await fetch(`/api/confirm-subscribe?token=${encodeURIComponent(token)}`);
        const data = await res.json();
        if (res.ok && data.success) {
          statusEl.textContent = 'Success! Your subscription is confirmed.';
        } else {
          statusEl.textContent = data.error || 'Unable to confirm your subscription.';
        }
      } catch (err) {
        statusEl.textContent = 'Something went wrong while confirming. Please try again.';
      }
    })();
  </script>
</BaseLayout>

<style>
  .confirm-page {
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    min-height: 70vh;
    padding: 3rem 1.5rem;


    .confirm-card {
      max-width: 40%;
      width: 100%;
      padding: 2rem;
    }

    h1 {
      margin-top: 0;
      margin-bottom: 1rem;
      font-size: 4rem;
      line-height: 1.3;
      
    }

    p {
      margin: 0;
      font-size: 1rem;
      line-height: 1.6;
    }
  }
</style>
