---
import BaseLayout from '@/layouts/BaseLayout.astro';

const url = new URL(Astro.request.url);
const token = url.searchParams.get('token');
---

<BaseLayout title="Confirm Subscription" description="Confirm your newsletter subscription">
  <main class="confirm-page">
    <section class="confirm-card" aria-live="polite">
      <h1>Confirm your subscription</h1>
      <p id="confirm-status">Processing your confirmationâ€¦</p>
    </section>
  </main>

  <script>
    (async () => {
      const params = new URLSearchParams(window.location.search);
      const token = params.get('token');
      const statusEl = document.getElementById('confirm-status');

      if (!token) {
        statusEl.textContent = 'Missing confirmation token.';
        return;
      }

      try {
        const res = await fetch(`/api/confirm-subscribe?token=${encodeURIComponent(token)}`);
        const data = await res.json();
        if (res.ok && data.success) {
          statusEl.textContent = 'Success! Your subscription is confirmed.';
        } else {
          statusEl.textContent = data.error || 'Unable to confirm your subscription.';
        }
      } catch (err) {
        statusEl.textContent = 'Something went wrong while confirming. Please try again.';
      }
    })();
  </script>
</BaseLayout>

<style>
  .confirm-page {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 70vh;
    padding: 3rem 1.5rem;
  }

  .confirm-card {
    max-width: 540px;
    width: 100%;
    background: var(--color-bg-elevated, rgba(255, 255, 255, 0.03));
    border: 1px solid var(--color-border, rgba(255, 255, 255, 0.08));
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  }

  .confirm-card h1 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1.75rem;
    line-height: 1.3;
  }

  .confirm-card p {
    margin: 0;
    font-size: 1rem;
    line-height: 1.6;
  }
</style>
