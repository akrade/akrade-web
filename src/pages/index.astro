---
import BaseLayout from '@/layouts/BaseLayout.astro';

// Design System
import '../styles/homepage.css';
---

<BaseLayout data-grainy-film="classic" theme="dark">
  
  <main id="homepage">
    <!-- Hero Section -->
    <section class="hero">
      <h1>Smart AI Product Strategy</h1>
      <p class="tagline">Data-driven clarity. Human-centered design. Measurable results.</p>
    </section>

    <!-- About Section -->
    <section id="about" class="about">
      <h2>Who We Are</h2>
      <p class="about-lede">
        Akradé is an AI-forward product strategy and human-centered design practice that helps
        organizations clarify vision, shape intelligent digital products, and deliver meaningful
        business outcomes. 
      </p>
      <p>
        We bring together AI consulting, product management expertise, 
        and user experience design to support teams through clear strategy, strong product leadership, 
        and modern design execution. By blending AI, systems thinking, and design-led product development, 
        Akradé helps companies accelerate innovation, reduce complexity, and build digital 
        solutions with confidence, clarity, and measurable impact.
      </p>
    </section>

    <!-- Services Section -->
    <section id="services" class="services">
      <h2>What We Offer</h2>
      <div class="services-grid">
        <div class="service-card">
          <h3>AI Product Strategy</h3>
          <p>Strategic roadmap development powered by AI insights and market intelligence.</p>
        </div>
        <div class="service-card">
          <h3>Product Management</h3>
          <p>End-to-end product leadership from strategy through delivery and iteration.</p>
        </div>
        <div class="service-card">
          <h3>Experience Design</h3>
          <p>User flow refinement and experience design that puts humans first.</p>
        </div>
        <div class="service-card">
          <h3>Product Definition</h3>
          <p>Clear requirements development and product scoping for confident execution.</p>
        </div>
        <div class="service-card">
          <h3>Discovery & Research</h3>
          <p>User interviews, competitive analysis, and market validation to inform product direction.</p>
        </div>
        <div class="service-card">
          <h3>Design Systems</h3>
          <p>Scalable component libraries and design standards for consistent product experiences.</p>
        </div>
      </div>
    </section>

  </main>

</BaseLayout>

<script is:inline>
  // @ts-nocheck
  // Handle Schedule a Meeting link in contact section - works with both initial load and View Transitions
  (function() {
    let cleanupFunctions = [];

    function initContactScheduleLink() {
      // Cleanup any existing listeners first
      cleanupFunctions.forEach(fn => fn());
      cleanupFunctions = [];

      const contactScheduleLink = document.getElementById('contact-schedule-link');

      if (contactScheduleLink) {
        const clickHandler = (e) => {
          e.preventDefault();
          // Call the global function exposed by ScheduleCallPanel
          if (typeof window.openSchedulePanel === 'function') {
            window.openSchedulePanel();
          }
        };

        contactScheduleLink.addEventListener('click', clickHandler);

        // Store cleanup function
        cleanupFunctions.push(() => {
          contactScheduleLink.removeEventListener('click', clickHandler);
        });
      }
    }

    // Initialize immediately on first load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initContactScheduleLink);
    } else {
      initContactScheduleLink();
    }

    // Re-initialize after View Transitions navigation
    document.addEventListener('astro:page-load', initContactScheduleLink);

    // Cleanup before navigation
    document.addEventListener('astro:before-preparation', () => {
      cleanupFunctions.forEach(fn => fn());
      cleanupFunctions = [];
    });
  })();

  // Scroll-based theme transitions
  // Works with both initial load and View Transitions
  (function() {
    let observer = null;

    function initScrollTransitions() {
      // Cleanup any existing observer
      if (observer) {
        observer.disconnect();
        observer = null;
      }

      const html = document.documentElement;
      const heroSection = document.querySelector('.hero');
      const aboutSection = document.querySelector('#about');
      const servicesSection = document.querySelector('#services');

      // Get grain effect elements
      const grainContainer = document.querySelector('.grain-container');

      // Add smooth transitions for theme changes
      html.style.transition = 'background-color 0.6s ease, color 0.6s ease';

      // Add transition to grain effect container
      if (grainContainer) grainContainer.style.transition = 'opacity 0.6s ease';

      // Helper function to toggle grain effect visibility
      function setGrainVisibility(visible) {
        const opacity = visible ? '1' : '0';
        if (grainContainer) grainContainer.style.opacity = opacity;
      }

      // Helper function to apply theme based on section
      function applyTheme(section) {
        if (section === heroSection) {
          html.setAttribute('data-theme', 'dark');
          setGrainVisibility(true);
        } else if (section === aboutSection) {
          html.setAttribute('data-theme', 'light');
          setGrainVisibility(false);
        } else if (section === servicesSection) {
          html.setAttribute('data-theme', 'dark');
          setGrainVisibility(true);
        }
      }

      // Track which section is currently active
      let activeSection = heroSection;

      // Initialize with hero theme
      if (heroSection) {
        applyTheme(heroSection);
      }

      // Observe sections with threshold array for better bidirectional scrolling detection
      const observerOptions = {
        root: null,
        rootMargin: '-40% 0px -40% 0px', // Middle 20% of viewport triggers change
        threshold: [0, 0.25, 0.5, 0.75, 1]
      };

      observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && entry.target !== activeSection) {
            activeSection = entry.target;
            applyTheme(activeSection);
          }
        });
      }, observerOptions);

      // Observe sections
      if (heroSection) observer.observe(heroSection);
      if (aboutSection) observer.observe(aboutSection);
      if (servicesSection) observer.observe(servicesSection);
    }

    // Initialize immediately on first load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initScrollTransitions);
    } else {
      initScrollTransitions();
    }

    // Re-initialize after View Transitions navigation
    document.addEventListener('astro:page-load', initScrollTransitions);

    // Cleanup before navigation
    document.addEventListener('astro:before-preparation', function() {
      if (observer) {
        observer.disconnect();
      }
    });
  })();
</script>
