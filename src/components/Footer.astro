---
const year = new Date().getFullYear();
import { NewsletterForm } from '@/packages/subscribe';

// Design System
import '../styles/footer.css';
import '@/packages/subscribe/newsletter.css';

---

<footer>
  <!-- Upper Footer - Contact & Links Section -->
  <div class="footer-upper">
    <div class="footer-upper-content">
      <div class="footer-upper-col">
        <a href="/about" class="footer-link">About</a>
        <a href="/services" class="footer-link">Services</a>
        <a href="/contact" class="footer-link">Contact</a>
        <a href="#"
          class="footer-link"
          data-trigger="schedule-panel"
          id="footer-schedule-link"
          >Let's Talk</a>
      </div>

      <div class="footer-upper-col">
        <div class="footer-contact-section">
          <h3 class="footer-heading">NEW BUSINESS</h3>
          <div class="footer-contact">
            <p><a href="tel:+14047819552" class="footer-contact-link">+1 404 781 9552</a></p>
            <p><a href="mailto:hello@akrade.com" class="footer-contact-link">hello@akrade.com</a></p>
          </div>
        </div>
      </div>

      <!-- Upper Footer - Newsletter & Social Media -->
      <div class="footer-upper-col">
        <h3 class="footer-heading">SIGN UP FOR OUR NEWSLETTER</h3>
        <NewsletterForm 
          client:load 
          variant="cta"
          description="Clear, actionable insights crafted for people leaders and product people who shape teams and build experiences."
          displayMode="panel"
          panelId="busyfolk-newsletter"
          ctaText="Join BusyFolk"
          />
        <div class="footer-social">
          <a href="https://linkedin.com/company/akrade" target="_blank" rel="noopener noreferrer" class="footer-social-link special-underline">LinkedIn</a>
          <a href="https://instagram.com/akrade" target="_blank" rel="noopener noreferrer" class="footer-social-link special-underline">Instagram</a>
          <a href="https://www.threads.com/@akrade" target="_blank" rel="noopener noreferrer" class="footer-social-link special-underline">Threads</a>
          <a href="https://x.com/akradeco" target="_blank" rel="noopener noreferrer" class="footer-social-link special-underline">X</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Lower Footer - Legal & Copyright -->
  <div class="footer-lower">
    <div class="footer-content">
      <div class="footer-col">
        <p class="copyright">Â© {year} Akrade, LLC. All Rights Reserved.</p>
      </div>

      <div class="footer-col">
        <a href="/legal/terms" rel="noopener noreferrer" aria-label="Terms of Service">Terms</a>
        <a href="/legal/privacy-policy" rel="noopener noreferrer" aria-label="Privacy Policy">Privacy</a>
        <a href="/legal/cookie-policy" rel="noopener noreferrer" aria-label="Cookie Policy">Cookies</a>
      </div>
    </div>
  </div>
</footer>

<script is:inline>
  // @ts-nocheck
  // Handle "Let's Talk" link to open schedule panel - works with both initial load and View Transitions
  (function() {
    let cleanupFunctions = [];

    function initFooterLinks() {
      // Cleanup any existing listeners first
      cleanupFunctions.forEach(fn => fn());
      cleanupFunctions = [];

      const linkConfigs = [
        {
          id: 'footer-schedule-link',
          action: () => {
            if (typeof window.openSchedulePanel === 'function') {
              window.openSchedulePanel();
            } else {
              console.error('openSchedulePanel function not found');
            }
          }
        },
        {
          id: 'footer-busyfolk-link',
          action: () => {
            if (typeof window.openBusyfolkNewsletterPanel === 'function') {
              window.openBusyfolkNewsletterPanel();
            } else {
              console.error('openBusyfolkNewsletterPanel function not found');
            }
          }
        }
      ];

      linkConfigs.forEach(({ id, action }) => {
        const link = document.getElementById(id);
        if (!link) return;

        const clickHandler = (e) => {
          e.preventDefault();
          action();
        };

        link.addEventListener('click', clickHandler);
        cleanupFunctions.push(() => {
          link.removeEventListener('click', clickHandler);
        });
      });
    }

    // Initialize immediately on first load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initFooterLinks);
    } else {
      initFooterLinks();
    }

    // Re-initialize after View Transitions navigation
    document.addEventListener('astro:page-load', initFooterLinks);

    // Cleanup before navigation
    document.addEventListener('astro:before-preparation', () => {
      cleanupFunctions.forEach(fn => fn());
      cleanupFunctions = [];
    });
  })();
</script>
